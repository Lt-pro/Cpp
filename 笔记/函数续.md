# 函数续

## 1、基本概念

- 函数是执行某个功能的模块
- 使用函数一般需要完成：函数原型、函数定义、调用函数
- 库函数已完成函数原型和实现的工作，只需正确调用即可；自定义函数需要同时完成原型、定义和调用
- 函数定义由函数头和函数体组成，函数头指定了输入参数列表、返回类型和函数名；函数体决定了函数的具体实现。
- C++支持单个、多个和不定长参数列表；函数可以有返回值或无返回值(void函数)，C++不支持返回数组；有返回值的函数在第一条返回语句运行后结束。
- 函数原型由函数头加分号组成。不要求提供变量名，变量名也不要求与函数定义相同。
- ()或(void)表示参数列表为空，即无输入参数；(...)表示不指定参数列表，即可变长度参数。  
- 原型的作用：让编译器正确处理返回值、检查输入参数数目是否正确，输入参数类型是否正确以及相应的隐式转换
- 函数参数传递
    + 值传递：函数不使用原数据，而是使用原数据的副本。传入的参数被称为实参(argument), 拷贝的参数称为形参(parameters),修改形参不影响实参的值
    + 地址传递：虽然传入的指针是形参，但形参指针和实参指针指向的地址相同。指针本身不会改变，但指针指向的数据可以被改变。
    + 引用传递：传入参数的引用，可以直接修改实参的取值。如果传入值为实参本身会被隐式转换为引用。

## 2、函数和数组

- C++将数组名视为指针。
    
    ```C++
    double sum(double a[], int n);
    double sum(double a*, int n)
    {
        return 0;
    }
    ```
    当且仅当在函数头或函数原型中，`double a[]`与`double a*`等价。

- 指针本身并未指出数组的长度，必须显式的指定数组的长度
  
    ```C++
    void size(double a[])
    {
        using namespace std;
        cout <<a<<" = a "<<sizeof(a)<<" = sizeof a"<<endl;
    }

    double arr[4] = {111.0, 111.1, 111.11, 111.111};

    cout <<arr<<" = arr "<<sizeof(arr)<< = sizeof arr<<endl;
    size(arr);
    ```
    程序运行结果将是，arr和a地址相同，但arr字节数为32，a字节数为4。

- 传入的数组元素值可以被修改。若想阻止函数修改数组可以使用const修饰，这样的修饰不适用于存在多级间接引用的场景。
  
    ```C++
    void size(const double a[]);
    void size(const double a*);
    ```
    二者都被解释为指向常量的指针，此时无法通过*(a+i)或a[i]修改元素的值，但传入的数组不要求元素是常量。

- 使用数组区间
    + double sum(double a[], int n):指定数组类型、起始位置和元素个数
    + double sum(double a1*, double a2*): 用两个指针指向数组开头和结尾，该方法可以使用任何区间的数组。

- 函数和二维数组
    + 传入时二维数组被解释为指向指针的指针
    + 形如`int sum(int (*ar2)[4], int size)`和`int sum(int ar2[][4], int size)`在函数定义和函数原型中等价
    + 列数是固定的，行数需要额外指定
    + 不要用const修饰


## 3、函数与C字符串

- C++向函数传入C字符串有字符数组、字符串常量、字符指针三种形式，实质都是字符指针。
- C字符串有结束标记`\0`,无需传入字符串长度
- 函数无法返回C字符串，但可以返回字符串的地址。不要返回局部变量的地址。

## 4、函数与结构和类型

- 函数传入和返回结构与基本类型相似，传入与返回类型与结构相似
- 使用结构的指针可以修改结构本身或其成员
- 当结构本身比较大时传递指针是更合算的选择
- 使用引用与使用结构本身相同，但会修改结构的值

## 5、内联函数

- 内联函数在编译时会用相应的函数代码替换相应函数调用
- 在函数声明与定义前加入inline即可得到一个内联函数

    ```C++
    #include <iostream>

    inline double square(double x);

    int main()
    {
        double x = 3.0;
        cout <<square(x)<<endl;
        cout <<square(4.0+1.0)<<endl;

        return 0;
    }

    inline double square(double x)
    {
        return x*x;
    }
    ```
- 内联函数节省了调用的时间，但增加了代码量。比较适合短小的代码。

## 6、函数与引用

- 引用是变量的一个别名，使用引用与使用原变量相同，向函数传递变量的引用可以直接修改变量取值。
- 引用相当于某个变量的指针常量，必须被初始化，对引用取地址得到原变量的地址，对引用赋值将改变原变量的取值
- 传入引用所对应的实参必须为变量，当实参与引用参数不匹配时，将生成临时变量
- 临时变量生成规则：当引用参数为const，在实参类型正确但并非左值或实参类型不正确但可以转换为正确的类型时，生成临时变量
    + 左值：变量、数组元素、、结构成员、引用和解除引用的指针
    + 右值：字面值、表达式、返回值(可能)
- 返回引用与返回值本身
    + 返回值本身：值被复制到一个临时位置，然后被赋给某个变量(若有)
    + 返回引用：值被直接赋给某个变量(若有)，即不是原变量的副本
    + 返回引用可以返回传入的引用参数，不要返回临时变量的引用
- 推荐传入const引用参数，若不想修改返回值，可对返回引用用const修饰
- 传入结构或类对象时建议使用引用效率更高
- 指针的引用: `double * &p=NULL`

## 7、默认参数

- C++支持默认参数，默认值必须通过函数原型声明。
- 带参数列表的函数必须从右向左添加默认值
- 函数定义与无默认值相同

## 8、重载

- 重载允许存在多个同名不同特征标的函数
- 函数的参数列表称为函数特征标，当且仅当两个函数参数列表的元素个数、类型与顺序相同时函数的特征标相同。
- 调用函数时会寻找与其匹配的原型，若没有则将会进行强制类型转换找到最佳匹配类型，或者错误。
- 类型引用和类型本身视为同一特征标，const对象和非const对象不同
- 同名不同特征标的函数可以有不同返回值，反之不成立
  